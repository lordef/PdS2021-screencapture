#TODO: cancella questo file


Configurazioni: 
- alsa -i default
 
Quando si croppa, ci sta desync:
- ragionarte su come settare timebase, fps, sample_rate, etc.

Situazione attuale:
 -      FUNZIONANTE:

        RISOLUZIONE 
            massima -> 1920x1200 (L): 1920x1200=2.304.000
        VIDEO
            time_base.num = 1
            time_base.den = 12.5;
            bit_rate_tolerance = 400000
            bit_rate = 96000
            max_b_frames = 2;

        AUDIO
            bit_rate = 96000;
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2


-      TEST: solo risoluzione diversa -> video rallentato, audio regolare ma forse troncato

        RISOLUZIONE 
            crop: cropH(700), cropW(700): 700x700= 490.000
        VIDEO
            time_base.num = 1
            time_base.den = 12.5;
            bit_rate_tolerance = 400000
            bit_rate = 96000
            max_b_frames = 2;

        AUDIO
            bit_rate = 96000;
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2


-      TEST: video rallentatissimo
        cropH(700), cropW(700) -> 700x700  -> provo a proporzionare gli fps: 2.304.000:490.000 = 12.5 : x => x=2.65

        RISOLUZIONE 
            crop: cropH(700), cropW(700)
        VIDEO
            time_base.num = 1
            time_base.den = 2.65; <------------------------------------
            bit_rate_tolerance = 400000
            bit_rate = 96000
            max_b_frames = 2;

        AUDIO
            bit_rate = 96000;
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2


-      TEST: video molto veloce, registrazione di soli 3 secondi

        RISOLUZIONE 
            crop: cropH(700), cropW(700)
        VIDEO
            time_base.num = 1
            time_base.den = 25; <------------------------------------
            bit_rate_tolerance = 400000
            bit_rate = 96000
            max_b_frames = 2;

        AUDIO
            bit_rate = 96000;
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2


-      QUASI FUNZIONANTE: audio ok, video sembra veloce del doppio

        RISOLUZIONE 
            massima -> 1920x1200 (L)    <------------------------------------
        VIDEO
            time_base.num = 1
            time_base.den = 25;         <------------------------------------
            bit_rate_tolerance = 400000
            bit_rate = 90000            <------------------------------------
            max_b_frames = 2;

        AUDIO   
            bit_rate = 90000            <------------------------------------
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2

-      QUASI FUNZIONANTE: audio ok, video si perde solo ultimo secondo

        RISOLUZIONE 
            massima -> 1920x1200 (L)    <------------------------------------
        VIDEO
            time_base.num = 1
            time_base.den = 12.5;         <------------------------------------
            bit_rate_tolerance = 400000
            bit_rate = 90000            <------------------------------------
            max_b_frames = 2;

        AUDIO   
            bit_rate = 90000            <------------------------------------
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2


-      QUASI FUNZIONANTE: audio ok, ma video molto veloce, sembra sempre intorno al doppio

        RISOLUZIONE 
            massima -> 1920x1200 (L)    
        VIDEO
            time_base.num = 1
            time_base.den = 25;         <------------------------------------
            bit_rate_tolerance = 400000
            bit_rate = 90000            
            max_b_frames = 2;
            av_opt_set(outAVCodecContext->priv_data, "preset", "veryslow", 0); <----------- era slow
            outAVCodecContext->gop_size = 0; <----------- era 10
            outAVCodecContext->max_b_frames = 0; <------------------ era 2
        AUDIO   
            bit_rate = 90000            
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2
-----------------------------------------
- 2022.02.24
 -      FUNZIONANTE: accettabile, audio ok, video 25 sec su 26 sec

        RISOLUZIONE 
            3072x1920 (wxh) (massima L)   
        VIDEO
            time_base.den = 12.5;
            bit_rate_tolerance = 400000
            bit_rate = 90000            
        AUDIO   
            bit_rate = 90000            
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2   

 -      FUNZIONANTE: accettabile - video ok (10 sec su 10 sec), audio leggermente in ritardo all'inizio

        RISOLUZIONE 
            700x700 (wxh)
        VIDEO
            time_base.den = 33; <--------------
            bit_rate_tolerance = 400000
            bit_rate = 90000            
        AUDIO   
            bit_rate = 90000            
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2   

 -      FUNZIONANTE: accettabile - video ok (10 sec su 10 sec), audio leggermente in ritardo all'inizio

        RISOLUZIONE 
            400x1000 (wxh)
        VIDEO
            time_base.den = 33; <--------------
            bit_rate_tolerance = 400000
            bit_rate = 90000            
        AUDIO   
            bit_rate = 90000            
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2   

-      FUNZIONANTE: accettabile - audio ok, video 9sec di 13

        RISOLUZIONE 
            3072x1000 (wxh)
        VIDEO
            time_base.den = 12.5; <--------------
            bit_rate_tolerance = 400000
            bit_rate = 90000            
        AUDIO   
            bit_rate = 90000            
            NON settato: time_base = { 1, inAudioCodecContext->sample_rate }; //#FIXME: dovrebbe settarsi da solo nelle prossime due operaioni a detta dei colleghi; ovvero flags e avcodec_open2               
---------------------------------------------------------------
CROPPING:
Prova1
magic Number 100
cropH 300 sia in openCamera che in generateVideoStream
cropW 1000 sia in openCamera che in generateVideoStream
X,Y 0
-> video ok audio muto per 2/3 del video

Prova2
prova con dimensioni massime -> tutto funzionante

se si ritaglia, si taglia l’audio

Prova3
openCamera con cropW e cropH
generateVideoStream con la massima risoluzione
-> video strano compresso, l’audio si blocca a 6 sec di 10 sec totali

video size deve essere cropH e cropW

------------
Prova risoluzione problema desync quando si croppa

Andiamo a ragionare su timebase, sia audio che video
Ragionare su saple rate -> per l'audio

Prima prova
time_base.den e time_base.num uguali per audio e video  -> questa prova da file corrotto (modificato)
---------------------------------------------------------------

2022.02.23 

- CONFIGURAZIONE come gruppo a: audio ok, video 9 sec su 24

    scaledFrame->pts = pts; 
    pts += scaledFrame->nb_samples;

    //a --> attivata questa sezione
    attiavati ovvero alcuni av_dict

    outAVCodecContext->time_base.den = 33;//a
    outAVCodecContext->bit_rate = 10000000; //FIXME: era 10 000 000, G: 96000, LeI:90000
    audio: outAudioCodecContext->bit_rate = 96000; // G: 96000, L&I:90000


    annullato e soppresse variabili: 
    ptsV = outPacket->pts / video_st->time_base.den;
    ptsA = outPacket->pts / outAudioCodecContext->sample_rate;

- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: audio ok, video 12 sec su 24
    outAVCodecContext->time_base.den = 25;

- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: audio ok, video 25 sec su 29
    outAVCodecContext->time_base.den = 12.5;

FUNZIONANTE
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: audio ok, video sembra ok -> 29 su 29 circa
    outAVCodecContext->time_base.den = 11;
-------------
Prova CROP 700x700: 
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video rallentato, audio per 10 sec, video per 27
    outAVCodecContext->time_base.den = 11;

- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video rallentato, audio per 10 sec, video per 27 => uguale a prima
    outAVCodecContext->time_base.den = 25;

FUNZIONANTE
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video e audio ok, registrazione 10 sec 
    outAVCodecContext->time_base.den = 33;
--------------
FUNZIONANTE
Prova CROP 100x150 (wxh): 
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video e audio ok, registrazione 10 sec 
    outAVCodecContext->time_base.den = 33;
--------------
FUNZIONANTE
Prova CROP 700x1020 (wxh): 
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video e audio ok, registrazione 10 sec 
    outAVCodecContext->time_base.den = 33;
--------------
FUNZIONANTE
Prova CROP 1020x330 (wxh): 
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video e audio ok, registrazione 10 sec 
    outAVCodecContext->time_base.den = 33;
--------------
FUNZIONANTE accettabile
Prova CROP 1720x1000 (wxh): (200 in meno rispetto a massima: 1920x1200)
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: audio ok, video 9sec su 10sec => ok
    outAVCodecContext->time_base.den = 33;
--------------
FUNZIONANTE accettabile
Prova CROP 1920x1200 (wxh)
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: audio ok, video 8 sec su 10 sec
    outAVCodecContext->time_base.den = 33;
--------------
Prova CROP 3072x1920 (wxh) (massima) -> 22 su 27
- CONFIGURAZIONE come gruppo a -> NOSTRA MODIFICA: video lento, audio 22 sec su 27 sec
    outAVCodecContext->time_base.den = 11;
[...] -> continua qui









